<!DOCTYPE html>
<html lang="en">
    {% load static %}
<style>
    body {
            background-image: url("{% static 'img/r1_bg.jpg' %}");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Styled Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    
    <!-- Link to the CSS file -->
    <link rel="stylesheet" href="{% static 'css/r1_quest.css' %}">
    
    <!-- Google Fonts for Nunito -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Team name outside, just above quiz-container -->
    <div class="leader-board">
        <h2>LEADER BOARD</h2>
        {% for team in teams %}
            <div class="team-score">
                <span class="team-name">{{ team }}</span>
                <span class="team-score">{{ team.score }}</span>
            </div>
        {% endfor %}
    </div>
    
    <div class="team-container">
        <div class="team">
            <h1>{{ team }}</h1>
        </div>
    </div>

    <div class="quiz-container">
        <form method="post">
            {% csrf_token %}
            <div class="question-text">
                {% if bnt == "qes" %}
                    <h1>{{ quest }}</h1>
                {% else %}
                    {% if ans %}
                        <h1>{{ quest }}</h1>
                        <div class="response-message">Right</div>
                        <div class="question-text">{{ quest.ans }}</div>
                    {% else %}
                        {% if spec %}
                            <h1>{{ quest }}</h1>
                            <div class="question-text">{{ quest.ans }}</div>
                        {% else %}
                            <h1>{{ quest }}</h1>
                            <div class="response-message">Wrong</div>
                            <input type="hidden" name="wrong" value="wrong">
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
            <!-- {{spec}} -->
            <button type="hidden" name="bnt" id="bnt" value="{{ bnt }}"></button>
            
            <input type="hidden" name="counter" value="{{ counter }}">
            <input type="hidden" name="pass_counter" value="{{ pass_counter }}">
            <input type="hidden" name="team_counter" value="{{ team_counter }}">
            <input type="hidden" name="ans" id="ans" value="">
        </form>
    </div>
    
    <div class="status-bar">
        <div class="question-counter">Question {{ d_counter }} of {{ count }}</div>
    </div>

    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>

    <div class="timer-container">
        <div class="timer">16</div><!-- Timer display -->
        <div class="timer-bar" id="timer-bar"></div> <!-- Shrinking timer bar -->
    </div>
    

    <script>
        let timerInterval;
        let timerRunning = false;
        let remainingTime = 16; // 16 seconds

        document.addEventListener('DOMContentLoaded', function () {
            document.addEventListener('keydown', function (event) {
                const ansInput = document.getElementById('ans');
                const submitButton = document.getElementById('bnt');

                if (event.key === 'y') {
                    ansInput.value = 'y';
                    if (submitButton) {
                        submitButton.click();
                    }
                }

                if (event.key === 'p') {
                    ansInput.value = 'p';
                    if (submitButton) {
                        submitButton.click();
                    }
                }

                if (event.key === 'n') {
                    ansInput.value = 'n';
                    if (submitButton) {
                        submitButton.click();
                    }
                }

                // Spacebar to start/pause timer
                if (event.key === ' ') {
                    if (!timerRunning) {
                        startTimer();
                    } else {
                        pauseTimer();
                    }
                }
            });

            const progressBar = document.getElementById('progress');
            const totalQuestions = parseInt('{{ count }}', 10);
            const currentQuestion = parseInt('{{ d_counter }}', 10);

            if (totalQuestions > 0 && currentQuestion > 0) {
                const progressPercent = (currentQuestion / totalQuestions) * 100;
                if (progressPercent <= 100 && progressPercent >= 0) {
                    progressBar.style.width = progressPercent + '%';
                }
            }
        });

        function startTimer() {
    timerRunning = true;
    const timerBar = document.getElementById('timer-bar');
    const totalDuration = remainingTime;

    timerInterval = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();

        // Calculate the new width of the timer bar based on remaining time
        const barWidthPercent = (remainingTime / totalDuration);
        if (timerBar) {
            timerBar.style.transform = `scaleX(${barWidthPercent})`; // Scale the bar from center
        }

        if (remainingTime <= 0) {
            clearInterval(timerInterval);
            timerRunning = false;
            // Handle timer expiration action here
        }
    }, 1000); // Update every second (1000ms)
}



        function pauseTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
        }

        function updateTimerDisplay() {
            const timerDisplay = document.querySelector('.timer');
            if (timerDisplay) {
                timerDisplay.textContent = remainingTime;
            }
        }
    </script>
</body>

</html>
