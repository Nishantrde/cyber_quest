<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Round 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    {% load static %}
    <style>
        body {
            background-image: url("{% static 'img/r2_bg.jpg' %}");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* Styling for highlighted option */
        .selected {
            background-color: #7db9e8 !important;
            box-shadow: 0px 0px 12px rgba(0, 0, 0, 0.5);
            border: 2px solid #0000ff;
        }

        /* Other CSS */
    </style>
    <link rel="stylesheet" href="{% static 'css/r2_quest.css' %}">

</head>
<body>

    <h1 id="heading">MCQ Round</h1>
    <div class="leader-board">
        <h2>LEADER BOARD</h2>
        {% for team in teams %}
            <div class="team-score">
                <span class="team-name">{{ team }}</span>
                <span class="team-score">{{ team.score }}</span>
            </div>
        {% endfor %}
    </div>

    <!-- Display team name -->
    <div class="team-container">
        <div class="team">
            <h1>{{ team.team_name }}</h1>
        </div>
    </div>

    <!-- Display question or answer feedback based on crr -->
    <div class="quiz-container">
        <form method="post" id="quiz-form" action="/r2_quest/{{count}}/{{team_id}}">
            {% csrf_token %}
            
            {% if crr == "qes" %}
                <div class="question-text">
                    <h2>{{ quest.quest }}</h2>
                </div>
                <table class="styled-options-table">
                    <tr>
                      <td>
                        <div class="option-box" data-option="1">
                          <span class="option-label option-a">A</span>
                          <span class="option-text">{{ quest.option1 }}</span>
                        </div>
                      </td>
                      <td>
                        <div class="option-box" data-option="2">
                          <span class="option-label option-b">B</span>
                          <span class="option-text">{{ quest.option2 }}</span>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="option-box" data-option="3">
                          <span class="option-label option-c">C</span>
                          <span class="option-text">{{ quest.option3 }}</span>
                        </div>
                      </td>
                      <td>
                        <div class="option-box" data-option="4">
                          <span class="option-label option-d">D</span>
                          <span class="option-text">{{ quest.option4 }}</span>
                        </div>
                      </td>
                    </tr>
                </table>
            {% elif crr == "ans" %}
                <div class="feedback">
                    {% if check == 1 %}
                        <p class="correct-answer">Correct Answer!</p>
                        <div class="round-container">
                            <video id="nahi" width="1700" autoplay>
                                <source src="{% static 'vid/noice.mp4' %}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <p class="correct-answer">{{ans}}</p>

                    {% elif check == 0 %}
                        <p class="wrong-answer">Wrong Answer!</p>
                        <div class="round-container">
                            <video id="nahi" width="1700" autoplay>
                                <source src="{% static 'vid/nahi.mp4' %}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <p class="correct-answer">{{ans}}</p>

                    {% endif %}
                </div>
                
            {% endif %}
    
            <!-- Hidden input to store the selected answer -->
            <input type="hidden" name="answer" id="answer-input" value="">
            <input type="hidden" name="counter" value="{{ counter }}">
            <input type="hidden" name="team_counter" value="{{ team_counter }}">
            <input type="hidden" name="crr" id="crr" value="{{crr}}">

            <button type="submit" class="submit-btn" style="display: none;">Submit</button>
        </form>
    </div>

    <div class="status-bar">
        <div class="question-counter">Question {{ counter }} of 12</div>
    </div>

    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>
    
    {% if crr == "qes" %}
    <div class="timer-container">
        <div class="timer">15</div>
        <div class="timer-bar" id="timer-bar"></div>
    </div>
    {% endif %}
    {% if crr == "qes" %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('quiz-form');
            const answerInput = document.getElementById('answer-input');
            const options = document.querySelectorAll('.option-box');
    
            // Variables for timer
            let remainingTime = 15;
            let timerRunning = false;
            let timerInterval;
    
            // Function to highlight the selected option
            function highlightOption(optionNumber) {
                options.forEach(option => {
                    option.classList.remove('selected'); // Remove highlight from all options
                    if (option.getAttribute('data-option') === optionNumber) {
                        option.classList.add('selected'); // Highlight the selected option
                    }
                });
            }
    
            // Listen for keydown events
            document.addEventListener('keydown', function (event) {
                if (['1', '2', '3', '4'].includes(event.key)) {
                    answerInput.value = event.key; // Set the selected answer
                    highlightOption(event.key); // Highlight the corresponding option
                }
    
                if (event.key === 'Enter') {
                    if (answerInput.value) {
                        form.submit(); // Submit the form when "Enter" is pressed
                    } else {
                        alert("Please select an answer by pressing 1, 2, 3, or 4 before pressing Enter.");
                    }
                }
    
                // Spacebar toggles timer
                if (event.key === ' ') {
                    event.preventDefault();
                    if (!timerRunning) {
                        startTimer();
                    } else {
                        pauseTimer(); // Toggle to pause
                    }
                }
            });
    
            // Timer and progress logic here...
            const progressBar = document.getElementById('progress');
            const totalQuestions = 12;
            const currentQuestion = parseInt('{{ counter }}', 10);
    
            if (totalQuestions > 0 && currentQuestion > 0) {
                const progressPercent = (currentQuestion / totalQuestions) * 100;
                if (progressPercent <= 100 && progressPercent >= 0) {
                    progressBar.style.width = progressPercent + '%';
                }
            }
    
            // Timer functionality
            function startTimer() {
                timerRunning = true;
                const timerBar = document.getElementById('timer-bar');
                const totalDuration = remainingTime;
    
                timerInterval = setInterval(() => {
                    remainingTime--;
                    updateTimerDisplay();
    
                    // Calculate the new width of the timer bar based on remaining time
                    const barWidthPercent = (remainingTime / totalDuration);
                    if (timerBar) {
                        timerBar.style.transform = `scaleX(${barWidthPercent})`; // Use template literals correctly
                    }
    
                    if (remainingTime <= 0) {
                        clearInterval(timerInterval);
                        timerRunning = false;
                        // Handle timer expiration action here, e.g., auto-submit
                        form.submit();
                    }
                }, 1000); // Update every second (1000ms)
            }
    
            function pauseTimer() {
                clearInterval(timerInterval); // Stop the timer
                timerRunning = false;
            }
    
            function updateTimerDisplay() {
                const timerDisplay = document.querySelector('.timer');
                if (timerDisplay) {
                    timerDisplay.textContent = remainingTime;
                }
            }
        });
    </script>
    
    {% else %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('quiz-form');
            const answerInput = document.getElementById('answer-input');
            const options = document.querySelectorAll('.option-box');
    
            // Variables for timer
            let remainingTime = 15;
            let timerRunning = false;
            let timerInterval;
    
            // Function to highlight the selected option
            function highlightOption(optionNumber) {
                options.forEach(option => {
                    option.classList.remove('selected'); // Remove highlight from all options
                    if (option.getAttribute('data-option') === optionNumber) {
                        option.classList.add('selected'); // Highlight the selected option
                    }
                });
            }
    
            // Listen for keydown events
            document.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    form.submit(); // Submit the form when "Enter" is pressed
                }
    
                // Spacebar toggles timer
                if (event.key === ' ') {
                    event.preventDefault();
                    if (!timerRunning) {
                        startTimer();
                    } else {
                        pauseTimer(); // Toggle to pause
                    }
                }
            });
    
            // Timer and progress logic here...
            const progressBar = document.getElementById('progress');
            const totalQuestions = 12;
            const currentQuestion = parseInt('{{ counter }}', 10);
    
            if (totalQuestions > 0 && currentQuestion > 0) {
                const progressPercent = (currentQuestion / totalQuestions) * 100;
                if (progressPercent <= 100 && progressPercent >= 0) {
                    progressBar.style.width = progressPercent + '%';
                }
            }
    
            // Timer functionality
            function startTimer() {
                timerRunning = true;
                const timerBar = document.getElementById('timer-bar');
                const totalDuration = remainingTime;
    
                timerInterval = setInterval(() => {
                    remainingTime--;
                    updateTimerDisplay();
    
                    // Calculate the new width of the timer bar based on remaining time
                    const barWidthPercent = (remainingTime / totalDuration);
                    if (timerBar) {
                        timerBar.style.transform = `scaleX(${barWidthPercent})`; // Use template literals correctly
                    }
    
                    if (remainingTime <= 0) {
                        clearInterval(timerInterval);
                        timerRunning = false;
                        // Handle timer expiration action here, e.g., auto-submit
                        form.submit();
                    }
                }, 1000); // Update every second (1000ms)
            }
    
            function pauseTimer() {
                clearInterval(timerInterval); // Stop the timer
                timerRunning = false;
            }
    
            function updateTimerDisplay() {
                const timerDisplay = document.querySelector('.timer');
                if (timerDisplay) {
                    timerDisplay.textContent = remainingTime;
                }
            }
        });
    </script>
    
    {% endif %}

    <style>
        .correct-answer {
            color: green;
            font-weight: bold;
            margin-top: 10px;
            font-size: 35px;
        }

        .wrong-answer {
            color: red;
            font-weight: bold;
            margin-top: 10px;
            font-size: 35px;
        }
    </style>

</body>
</html>
